#================================================================
# Mihomo (Clash.Meta) Core - Sub-Store æ¨¡æ¿
#
# ä½œè€…: Gemini
# æ—¥æœŸ: 2025-06-29
# ç‰ˆæœ¬: v2.0 (å·²æ•´åˆè‡ªå®šä¹‰åˆ†ç»„å’Œè§„åˆ™)
#
# ä½¿ç”¨è¯´æ˜:
# 1. å°†æ­¤æ–‡ä»¶çš„å†…å®¹ç²˜è´´åˆ° Sub-Store çš„ "æœ¬åœ°é…ç½®" æˆ– "æ¨¡æ¿é…ç½®" ç¼–è¾‘å™¨ä¸­ã€‚
# 2. Sub-Store ä¼šè‡ªåŠ¨å°†è¿œç¨‹è®¢é˜…ä¸­çš„èŠ‚ç‚¹åˆ—è¡¨å¡«å…¥æ­¤æ¨¡æ¿ï¼Œå¹¶ç”Ÿæˆæœ€ç»ˆçš„é…ç½®æ–‡ä»¶ã€‚
# 3. æ­¤æ¨¡æ¿ä¸“ä¸ºåœ¨æœåŠ¡å™¨ã€è·¯ç”±å™¨ç­‰æ— å¤´ç¯å¢ƒä¸‹è¿è¡Œçš„ Core ç‰ˆæœ¬ä¼˜åŒ–ã€‚
#
# ç‰¹ç‚¹:
# - é¢„è®¾é€šç”¨ç«¯å£å’Œå±€åŸŸç½‘è®¿é—®æƒé™ã€‚
# - å¼ºå¤§çš„ DNS Fake-IP æ¨¡å¼ï¼Œæœ‰æ•ˆé˜²æ±¡æŸ“å¹¶å®ç°ç²¾å‡†è·¯ç”±ã€‚
# - é¢„è®¾ TUN æ¨¡å¼ï¼Œå¯æ¥ç®¡ç³»ç»Ÿæ‰€æœ‰æµé‡ã€‚
# - å·²æ•´åˆå¤æ‚çš„å¤šçº§ä»£ç†åˆ†ç»„ç­–ç•¥å’ŒåŸºäº rule-provider çš„ç²¾ç»†åŒ–åˆ†æµè§„åˆ™ã€‚
#================================================================

#------------------------------------------------
# åŸºç¡€é…ç½® (Ports & General Settings)
#------------------------------------------------
mixed-port: 7890             # HTTP å’Œ SOCKS5 æ··åˆä»£ç†ç«¯å£
redir-port: 7892             # é€æ˜ä»£ç† (Redirect) ç«¯å£
tproxy-port: 7893            # é€æ˜ä»£ç† (TProxy) ç«¯å£
allow-lan: true              # å…è®¸æ¥è‡ªå±€åŸŸç½‘çš„è¿æ¥
bind-address: '*'            # ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ ('*' è¡¨ç¤ºæ‰€æœ‰, '127.0.0.1' è¡¨ç¤ºä»…æœ¬æœº)
mode: rule                   # æ¨¡å¼: rule(è§„åˆ™) / global(å…¨å±€) / direct(ç›´è¿)
log-level: info              # æ—¥å¿—çº§åˆ«: silent / error / warning / info / debug
ipv6: true                   # å¼€å¯ IPv6 æ”¯æŒ

#------------------------------------------------
# å¤–éƒ¨æ§åˆ¶ & Web UI
#------------------------------------------------
external-controller: '0.0.0.0:9090'  # RESTful API ç›‘å¬åœ°å€ï¼Œå…è®¸å¤–éƒ¨è®¿é—®
# external-ui: /etc/mihomo/ui        # (å¯é€‰) Web UI (å¦‚ metacubexd) çš„æ–‡ä»¶è·¯å¾„
# secret: ""                         # (å¯é€‰) API è®¿é—®å¯†é’¥ï¼Œå¢å¼ºå®‰å…¨æ€§

#------------------------------------------------
# DNS é…ç½® (æ ¸å¿ƒåŠŸèƒ½)
#------------------------------------------------
dns:
  enable: true
  listen: 0.0.0.0:1053          # DNS ç›‘å¬ç«¯å£
  ipv6: true                    # å…è®¸è§£æ AAAA è®°å½•
  enhanced-mode: fake-ip        # å¢å¼ºæ¨¡å¼: fake-ip (æ¨è) æˆ– redir-host
  fake-ip-range: 198.18.0.1/16  # Fake-IP ä½¿ç”¨çš„åœ°å€æ± 
  use-hosts: true               # ä½¿ç”¨ç³»ç»Ÿ hosts æ–‡ä»¶
  nameserver:
    - https://223.5.5.5/dns-query     # AliDNS
    - https://doh.pub/dns-query       # Tencent DoH
    - tls://dns.google                # Google DoT
  fallback:
    - https://1.1.1.1/dns-query       # Cloudflare
    - https://dns.quad9.net/dns-query # Quad9
    - tls://8.8.4.4:853
  nameserver-policy:
    'geosite:cn':
      - https://223.5.5.5/dns-query
      - https://doh.pub/dns-query
    'geosite:apple_cn':
      - https://223.5.5.5/dns-query

#------------------------------------------------
# TUN æ¨¡å¼ (å¯é€‰, ç”¨äºæ¥ç®¡ç³»ç»Ÿæ‰€æœ‰æµé‡)
#------------------------------------------------
tun:
  enable: true
  stack: gvisor                 # åè®®æ ˆ: system / gvisor / mixed
  dns-hijack:
    - any:1053                  # åŠ«æŒæ‰€æœ‰å‘å¾€ 1053 ç«¯å£çš„ DNS æŸ¥è¯¢
  auto-route: true              # è‡ªåŠ¨è®¾ç½®è·¯ç”±è¡¨ï¼Œå°†æµé‡å¯¼å‘ TUN
  auto-detect-interface: true   # è‡ªåŠ¨æ£€æµ‹å‡ºå£ç½‘å¡

#================================================================
# Sub-Store å¡«å……åŒºåŸŸ
# proxies: []
# proxy-groups: []
# rule-providers: []
# rules: []
#================================================================

#------------------------------------------------
# ä»£ç†ç»„ (Proxy Groups)
#------------------------------------------------
proxy-groups:
  - name: 'ProxyScheme'
    type: select
    proxies:
      - 'DailyLowRate'
      - 'RegionSelect'
      - 'GlobalAuto'
      - 'ResidentialISP'
      - 'AutoFallback'
      - 'DownloadNodes'
      - DIRECT
      # $proxies # Sub-Store ä¼šåœ¨æ­¤å¤„æ’å…¥æ‰€æœ‰èŠ‚ç‚¹

  - name: 'RegionSelect'
    type: select
    proxies:
      - 'HongKong'
      - 'Taiwan'
      - 'Japan'
      - 'Korea'
      - 'Singapore'
      - 'USA'
      - 'America'
      - 'Europe'
      - 'Others'

  - name: 'DailyLowRate'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    filter: 7li7li
    exclude-filter: (?i)(GB|Traffic|Expire|Premium|é¢‘é“|è®¢é˜…|ISP|æµé‡|åˆ°æœŸ|é‡ç½®|x([2-9]|\d{2,})(\.\d+)?|(([2-9]|\d{2,})(\.\d+)?)[XxÃ—]|èŒäº‘|é¦™æ¸¯)
    proxies:
      # $proxies

  - name: 'GlobalAuto'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    exclude-filter: (?i)GB|Traffic|Expire|Premium|é¢‘é“|è®¢é˜…|ISP|æµé‡|åˆ°æœŸ|é‡ç½®|é¦™æ¸¯|èŒäº‘|æ–°åŠ å¡
    proxies:
      # $proxies

  - name: 'ResidentialISP'
    type: select
    filter: Fam
    exclude-filter: é¦™æ¸¯|HK|ğŸ‡­ğŸ‡°
    proxies:
      # $proxies

  - name: 'AutoFallback'
    type: fallback
    url: 'http://www.gstatic.com/generate_204'
    interval: 7200
    exclude-filter: (?i)GB|Traffic|Expire|Premium|é¢‘é“|è®¢é˜…|ISP|æµé‡|åˆ°æœŸ|é‡ç½®
    proxies:
      # $proxies

  - name: 'DownloadNodes'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    filter: (?i)(?:[xÃ—å€])\s*0\.\d+|0\.\d+\s*(?:[xÃ—å€])|Test|6bcloud|èµ·å¸†
    exclude-filter: 6bcloudä¸¨ å°æ¹¾ GPT|è¶Šå—
    proxies:
      # $proxies

  - name: 'HongKong'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    filter: é¦™æ¸¯|HK|ğŸ‡­ğŸ‡°
    proxies:
      # $proxies

  - name: 'Taiwan'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    filter: å°æ¹¾|TW|ğŸ‡¹ğŸ‡¼
    proxies:
      # $proxies

  - name: 'Japan'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    filter: æ—¥æœ¬|JP|ğŸ‡¯ğŸ‡µ
    proxies:
      # $proxies

  - name: 'Korea'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    filter: éŸ©å›½|KR|ğŸ‡°ğŸ‡·
    proxies:
      # $proxies

  - name: 'Singapore'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    filter: æ–°åŠ å¡|SG|ğŸ‡¸ğŸ‡¬
    proxies:
      # $proxies

  - name: 'USA'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    filter: ç¾å›½|US|ğŸ‡ºğŸ‡¸
    proxies:
      # $proxies

  - name: 'America'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    filter: åŠ æ‹¿å¤§|CA|ğŸ‡¨ğŸ‡¦|å·´è¥¿|BR|ğŸ‡§ğŸ‡·|æ™ºåˆ©|CL|ğŸ‡¨ğŸ‡±
    proxies:
      # $proxies

  - name: 'Europe'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    filter: å¾·å›½|DE|ğŸ‡©ğŸ‡ª|æ³•å›½|FR|ğŸ‡«ğŸ‡·|è‹±å›½|GB|ğŸ‡¬ğŸ‡§|è·å…°|NL|ğŸ‡³ğŸ‡±|æ„å¤§åˆ©|IT|ğŸ‡®ğŸ‡¹
    proxies:
      # $proxies

  - name: 'Others'
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 86400
    tolerance: 50
    exclude-filter: (?i)GB|Traffic|Expire|Premium|é¢‘é“|è®¢é˜…|ISP|æµé‡|åˆ°æœŸ|é‡ç½®|å¾·å›½|DE|ğŸ‡©ğŸ‡ª|æ³•å›½|FR|ğŸ‡«ğŸ‡·|è‹±å›½|GB|ğŸ‡¬ğŸ‡§|è·å…°|NL|ğŸ‡³ğŸ‡±|æ„å¤§åˆ©|IT|ğŸ‡®ğŸ‡¹|ç¾å›½|US|ğŸ‡ºğŸ‡¸|åŠ æ‹¿å¤§|CA|ğŸ‡¨ğŸ‡¦|å·´è¥¿|BR|ğŸ‡§ğŸ‡·|æ™ºåˆ©|CL|ğŸ‡¨ğŸ‡±|é¦™æ¸¯|HK|ğŸ‡­ğŸ‡°|å°æ¹¾|TW|ğŸ‡¹ğŸ‡¼|æ—¥æœ¬|JP|ğŸ‡¯ğŸ‡µ|éŸ©å›½|KR|ğŸ‡°ğŸ‡·|æ–°åŠ å¡|SG|ğŸ‡¸ğŸ‡¬
    proxies:
      # $proxies

#------------------------------------------------
# è§„åˆ™æä¾›è€… (Rule Providers)
#------------------------------------------------
rule-providers:
  Apple:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple_Classical.yaml
    interval: 86400
  Telegram:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml
    interval: 86400
  YouTube:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml
    interval: 86400
  BiliBili:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/BiliBili/BiliBili.yaml
    interval: 86400
  TikTok:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/TikTok/TikTok.yaml
    interval: 86400
  Spotify:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.yaml
    interval: 86400
  Netflix:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Netflix/Netflix.yaml
    interval: 86400
  Disney:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Disney/Disney.yaml
    interval: 86400
  Google:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml
    interval: 86400
  OpenAI:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml
    interval: 86400
  Microsoft:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml
    interval: 86400
  Twitter:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter.yaml
    interval: 86400
  Steam:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Steam/Steam.yaml
    interval: 86400
  OneDrive:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OneDrive/OneDrive.yaml
    interval: 86400
  Emby:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Emby/Emby.yaml
    interval: 86400
  Gemini:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.yaml
    interval: 86400
  Claude:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Claude/Claude.yaml
    interval: 86400
  Github:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub_No_Resolve.yaml
    interval: 86400

#------------------------------------------------
# è§„åˆ™ (Rules)
#------------------------------------------------
rules:
  - RULE-SET,Telegram,ProxyScheme
  - RULE-SET,YouTube,DownloadNodes
  - RULE-SET,BiliBili,DIRECT
  - RULE-SET,TikTok,DownloadNodes
  - RULE-SET,Spotify,DownloadNodes
  - RULE-SET,Netflix,DownloadNodes
  - RULE-SET,Disney,DownloadNodes
  - RULE-SET,Google,ProxyScheme
  - RULE-SET,OpenAI,ResidentialISP
  - RULE-SET,Microsoft,ProxyScheme
  - RULE-SET,Twitter,ProxyScheme
  - RULE-SET,Steam,ProxyScheme
  - RULE-SET,OneDrive,DownloadNodes
  - RULE-SET,Emby,DownloadNodes
  - RULE-SET,Github,ProxyScheme
  - GEOIP,CN,DIRECT
  - MATCH,ProxyScheme
